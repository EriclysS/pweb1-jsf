-- Database: "Biblioteca-TCCs"

-- DROP DATABASE "Biblioteca-TCCs";

CREATE DATABASE "Biblioteca-TCCs"
  WITH OWNER = postgres
       ENCODING = 'UTF8'
       TABLESPACE = pg_default
       LC_COLLATE = 'Portuguese_Brazil.1252'
       LC_CTYPE = 'Portuguese_Brazil.1252'
       CONNECTION LIMIT = -1;

CREATE TABLE USUARIO(
	EMAIL VARCHAR(80),             
	TIPO_USUARIO BOOLEAN NOT NULL,         
	FOTO_PERFIL BYTEA,  
	NOME VARCHAR(50) NOT NULL,
	SEXO CHAR(1) NOT NULL,
	SENHA VARCHAR(30) NOT NULL,
	TELEFONE VARCHAR(20),
	PRIMARY KEY(EMAIL)
);


CREATE TABLE ENDERECO(
	EMAIL_USUARIO VARCHAR(80) NOT NULL,              
	CIDADE VARCHAR(80) NOT NULL,
	ESTADO VARCHAR(80) NOT NULL,
	RUA VARCHAR(80) NOT NULL,
	NUMERO INT NOT NULL, 
	CEP VARCHAR(20)NOT NULL, 
	PRIMARY KEY(EMAIL_USUARIO),
	FOREIGN KEY(EMAIL_USUARIO) REFERENCES USUARIO(EMAIL) ON DELETE CASCADE	
);

CREATE TABLE TCC(
	ID_TCC SERIAL NOT NULL, 
	EMAIL_USUARIO VARCHAR(80) NOT NULL,             
	TITULO VARCHAR(100) NOT NULL, 
	CURSO VARCHAR(80) NOT NULL,
	DESCRICAO TEXT NOT NULL,
	ARQUIVO_DADOS BYTEA NOT NULL,            
	ARQUIVO_NOME VARCHAR(255) NOT NULL,
	PRIMARY KEY(ID_TCC),
	FOREIGN KEY(EMAIL_USUARIO) REFERENCES USUARIO(EMAIL) ON DELETE CASCADE	
);

CREATE TABLE COMENTARIO(
	ID_COMENTARIO SERIAL NOT NULL,       
	ID_TCC INT NOT NULL,                 
	EMAIL_USUARIO VARCHAR(80) NOT NULL,             
	COMENTARIO TEXT NOT NULL, 
	PRIMARY KEY(ID_COMENTARIO, ID_TCC ,EMAIL_USUARIO),
	FOREIGN KEY(EMAIL_USUARIO) REFERENCES USUARIO(EMAIL) ON DELETE CASCADE,
	FOREIGN KEY(ID_TCC) REFERENCES TCC(ID_TCC) ON DELETE CASCADE
)